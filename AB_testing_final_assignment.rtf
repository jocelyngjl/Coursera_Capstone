{\rtf1\ansi\ansicpg1252\cocoartf2512
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;\f1\fnil\fcharset134 PingFangSC-Regular;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww10800\viewh8400\viewkind0
\deftab560
\pard\pardeftab560\slleading20\partightenfactor0

\f0\fs24 \cf0 We are running an experiment at an item-level, which means all users who visit will see the same page, but the layout of different item pages may differ.\
\
--Question 1
\f1 \'a3\'ba
\f0 \
--Compare this table to the assignment events we captured for user_level_testing.\
--Does this table have everything you need to compute metrics like 30-day view-binary?\
--No, we need the date and time of assignment to compute metrics like 30-day view-binary.\
\
SELECT \
  * \
FROM \
  dsv1069.final_assignments_qa\
  \
\
\
--Question 2
\f1 \'a3\'ba
\f0 \
--Reformat the final_assignments_qa to look like the final_assignments table, filling in any missing values with a placeholder of the appropriate data type.\
\
  SELECT \
       item_id,\
       test_a AS test_assignment,\
       (CASE\
            WHEN test_a IS NOT NULL then 'test_a'\
            ELSE NULL\
        END) AS test_label,\
       (CASE\
            WHEN test_a IS NOT NULL then '2013-01-05 00:00:00'\
            ELSE NULL\
        END) AS test_start_date\
FROM dsv1069.final_assignments_qa\
UNION\
SELECT item_id,\
       test_b AS test_assignment,\
       (CASE\
            WHEN test_b IS NOT NULL then 'test_b'\
            ELSE NULL\
        END) AS test_label,\
       (CASE\
            WHEN test_b IS NOT NULL then '2013-01-05 00:00:00'\
            ELSE NULL\
        END) AS test_start_date\
FROM dsv1069.final_assignments_qa\
UNION\
SELECT item_id,\
       test_c AS test_assignment,\
       (CASE\
            WHEN test_c IS NOT NULL then 'test_c'\
            ELSE NULL\
        END) AS test_label,\
       (CASE\
            WHEN test_c IS NOT NULL then '2013-01-05 00:00:00'\
            ELSE NULL\
        END) AS test_start_date\
FROM dsv1069.final_assignments_qa\
UNION\
SELECT item_id,\
       test_d AS test_assignment,\
       (CASE\
            WHEN test_d IS NOT NULL then 'test_d'\
            ELSE NULL\
        END) AS test_label,\
       (CASE\
            WHEN test_d IS NOT NULL then '2013-01-05 00:00:00'\
            ELSE NULL\
        END) AS test_start_date\
FROM dsv1069.final_assignments_qa\
UNION\
SELECT item_id,\
       test_e AS test_assignment,\
       (CASE\
            WHEN test_e IS NOT NULL then 'test_e'\
            ELSE NULL\
        END) AS test_label,\
       (CASE\
            WHEN test_e IS NOT NULL then '2013-01-05 00:00:00'\
            ELSE NULL\
        END) AS test_start_date\
FROM dsv1069.final_assignments_qa\
UNION\
SELECT item_id,\
       test_f AS test_assignment,\
       (CASE\
            WHEN test_f IS NOT NULL then 'test_f'\
            ELSE NULL\
        END) AS test_label,\
       (CASE\
            WHEN test_f IS NOT NULL then '2013-01-05 00:00:00'\
            ELSE NULL\
        END) AS test_start_date\
FROM dsv1069.final_assignments_qa\
\
\
--Question 3
\f1 \'a3\'ba
\f0 \
-- Use this table to \
-- compute order_binary for the 30 day window after the test_start_date\
-- for the test named item_test_2\
\
SELECT  test_number, \
        test_assignment, \
        COUNT(distinct item_id) AS item_assignment, \
        SUM(order_binary)       AS order_binary_30_day\
    \
FROM\
  ( \
    SELECT \
        test_events.item_id,\
        test_events.test_number,\
        test_events.test_assignment,\
        test_events.created_at,\
        test_events.test_start_date,\
        (CASE WHEN  (created_at >  test_start_date AND \
             DATE_PART('day', created_at - test_start_date) <= 30) \
             THEN 1 \
             ELSE 0 \
         END) AS order_binary\
     FROM\
         (SELECT\
              final_assignments.item_id, \
              final_assignments.test_number, \
              final_assignments.test_assignment, \
              DATE(orders.created_at) as created_at, \
              final_assignments.test_start_date\
          FROM\
              dsv1069.final_assignments \
          LEFT JOIN \
              dsv1069.orders \
          ON  final_assignments.item_id = orders.item_id\
          WHERE \
              final_assignments.test_number = 'item_test_2'\
         ) as test_events\
         \
     GROUP BY\
          test_events.item_id,\
          test_events.test_number,\
          test_events.test_assignment,\
          test_events.created_at,\
          test_events.test_start_date\
  ) order_binary_table\
GROUP BY test_number, test_assignment;\
\
\
\
--Question 4
\f1 \'a3\'ba
\f0 \
-- Use this table to \
-- compute view_binary for the 30 day window after the test_start_date\
-- for the test named item_test_2\
\
SELECT\
   test_assignment,\
   SUM(binary_view) AS viewed_items,\
   COUNT(item_id) AS items_assignment,\
   SUM(views) AS total_views,\
   SUM(views)/COUNT(item_id) AS average_views\
FROM\
(\
   SELECT \
       final_assignments.test_assignment,\
       final_assignments.item_id, \
       MAX(CASE WHEN views.event_time > final_assignments.test_start_date THEN 1 \
       ELSE 0 \
    END)  AS binary_view,\
       COUNT(views.event_id) AS views\
   FROM \
      dsv1069.final_assignments\
   LEFT JOIN \
      (\
         SELECT \
             event_time,\
             event_id,\
             CAST(parameter_value AS INT) AS item_id\
         FROM \
             dsv1069.events \
         WHERE \
             event_name = 'view_item'\
         AND \
             parameter_name = 'item_id'\
      ) views\
   ON       \
        final_assignments.item_id = views.item_id\
   AND      \
        views.event_time >= final_assignments.test_start_date\
   AND      \
        DATE_PART('day', views.event_time - final_assignments.test_start_date ) <= 30 \
   WHERE    \
        final_assignments.test_number = 'item_test_2'\
   GROUP BY\
        final_assignments.item_id,\
        final_assignments.test_assignment\
)view_metrics\
  \
GROUP BY view_metrics.test_assignment;\
\
\
\
--Question 5
\f1 \'a3\'ba
\f0 \
--Use the https://thumbtack.github.io/abba/demo/abba.html to compute the lifts in metrics and the p-values for the binary metrics ( 30 day order binary and 30 day view binary) using an interval 95% confidence.\
\
--Order binary--Lift in test_2 is -0.5%, with a P-Value of 0.93. This essentially means that while orders appear to decrease in the test sample, the high P-Value indicates that the evidence is not strong enough to conclusively say so.\
\
\
--View binary--Lift in test_2 is 2.6%, with a P-value of 0.20. This essentially means that while views appear to increase in the test sample, the high P-value indicates that the evidence is not strong enough to conclusively say so.\
\
Therefore for item_test_2, there was no significant difference in either the number of views or the number of orders between control and experiment\
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0
\cf0 \
}